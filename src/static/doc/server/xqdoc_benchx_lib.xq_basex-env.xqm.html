<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta http-equiv="Generator" content="xquerydoc - https://github.com/xquery/xquerydoc"/><title>xqDoc - </title><style type="text/css">
          body {
          font-family: Helvetica;
          padding: 0.5em  1em;
          }
          pre {
          font-family: Inconsolata, Consolas, monospace;
          }
          ol.results {
          padding-left: 0;
          }
          .footer {
          text-align:right;
          border-top: solid 4px;
          padding: 0.25em 0.5em;
          font-size: 85%;
          color: #999;
          }
          li.result {
          list-style-position: inside;
          list-style: none;
          height:140px;
          }
          h2 {
          display: inline-block;
          margin: 0;
          }

          h2 a,
          .result h3 a {
          text-decoration: inherit;
          color: inherit;
          }
          h3{
	  font-size: 140%;
	  background-color: #aaa;
	  border-bottom: 1px solid #000;
	  width: 100%;
	  }
          h4{
	  font-size: 100%;
	  background-color: #ddd;
	  width: 90%;
	  }

          .namespace {
          color: #999;
          }
          .namespace:before {
          content: "{";
          }
          .namespace:after {
          content: "}";
          }
          table{
          width:75%;
          float:right;
          }
          td {
          height:100px;
          width:50%;
          vertical-align:text-top;
          }
        </style><script src="lib/prettify.js" type="text/javascript"> </script><script src="lib/lang-xq.js" type="text/javascript"> </script><link rel="stylesheet" type="text/css" href="lib/prettify.css"/></head><body class="home"><div id="main"><h1><span class="namespace"/>  error module </h1><div id="variables"><h3>Variables</h3></div><div id="functions"><h3>Functions</h3></div><div><h3>Original Source Code</h3><pre class="prettyprint lang-xq">xquery version "3.0";
(:~
: Get information about the BaseX ,java and host environment
: using java api calls
:
: @author andy bunce
: @since sept 2012
: @licence apache 2
:)
 
module namespace env = 'quodatum.basex.env';
declare default function namespace 'quodatum.basex.env';

declare namespace sys="java:java.lang.System";
declare namespace Runtime="java:java.lang.Runtime";
declare namespace ManagementFactory="java:java.lang.management.ManagementFactory";
declare namespace RuntimeMXBean="java:java.lang.management.RuntimeMXBean";
declare namespace InetAddress="java:java.net.InetAddress";

declare variable $env:core:=(
            "java.version","java.vendor","java.vm.version",
            "os.name","os.version","os.arch");
            
(:~ 
 : @return BaseX version string 
 :)
declare function basex-version() as xs:string
{
	db:system()/generalinformation/version
};

(:~ 
 : @return true if basex version is at least $minver e.g "7.8" 
 :)
declare function basex-minversion($minver as xs:string) as xs:boolean
{
 let $v:=fn:substring-before(basex-version()||" "," ")
 return fn:substring($v,1,fn:string-length($minver)) ge $minver
};

declare function getProperty($name as xs:string) as xs:string{
    sys:getProperty($name)
};

(: 
 : memory status
 :http://javarevisited.blogspot.co.uk/2012/01/find-max-free-total-memory-in-java.html
:)
declare function memory($human as xs:boolean) as map(*)
{
let $f:=if($human)then prof:human#1 else function($x){$x}
let $r:=Runtime:getRuntime()
return map{
    "runtime.freeMemory": $f(Runtime:freeMemory($r)),
    "runtime.maxMemory": $f(Runtime:maxMemory($r)),
    "runtime.totalMemory": $f(Runtime:totalMemory($r))
    }
};

(:~ useful properties as a map 
 :)
declare function about() as map(*)
{
 let $c:= map:merge($env:core!map:entry(.,sys:getProperty(.)))
 return map:merge((
                $c,
                memory(fn:true()),
                map:entry("basex.version",basex-version()),
                map:entry("runtime.availableProcessors",availableProcessors())
                ))
};

(:~ useful properties as xml
 :)
declare function xml() as element(environment)
{
    let $map:=about()
    return  &lt;environment&gt;{ for  $key in map:keys($map)
               order by $key
               return element {$key} {$map($key)}
        }&lt;/environment&gt;
};

declare function availableProcessors() as xs:integer
{
    let $r:=Runtime:getRuntime()
    return Runtime:availableProcessors($r)
};

(:~ 
 :JVM uptime as duration
 :)
declare function jvmUptime() as xs:dayTimeDuration
{
    let $r:=ManagementFactory:getRuntimeMXBean()
    return RuntimeMXBean:getUptime($r)* xs:dayTimeDuration('PT0.001S') 
};

(:~ 
 :JVM start time
 :)
declare function jvmStarttime() as xs:dateTime
{ 
	fn:current-dateTime()-jvmUptime()
};

(:~
 : hostname if available
 :)
declare function hostname() as xs:string
{
try{
    let $r:=InetAddress:getLocalHost()
    return InetAddress:getHostName($r)
} catch *{
    "?"   
    }

};</pre></div><br/><div class="footer"><p style="text-align:right"><i/> |
          generated by xquerydoc <a href="https://github.com/xquery/xquerydoc" target="xquerydoc">https://github.com/xquery/xquerydoc</a></p></div></div><script type="application/javascript">
	  window.onload = function(){ prettyPrint(); }
	</script></body></html>